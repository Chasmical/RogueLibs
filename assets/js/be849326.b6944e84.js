"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3221],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=l(n),h=i,u=m["".concat(c,".").concat(h)]||m[h]||p[h]||r;return n?a.createElement(u,o(o({ref:t},d),{},{components:n})):a.createElement(u,o({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4230:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return d},default:function(){return m}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],s={},c="Creating a Custom Interaction",l={unversionedId:"dev/interactions/create-interaction",id:"dev/interactions/create-interaction",title:"Creating a Custom Interaction",description:"Using SimpleInteractionProvider class",source:"@site/docs/dev/interactions/create-interaction.mdx",sourceDirName:"dev/interactions",slug:"/dev/interactions/create-interaction",permalink:"/RogueLibs/docs/dev/interactions/create-interaction",editUrl:"https://github.com/SugarBarrel/RogueLibs/edit/main/website/docs/dev/interactions/create-interaction.mdx",tags:[],version:"current",frontMatter:{},sidebar:"documentationSidebar",previous:{title:"Creating a Custom Effect",permalink:"/RogueLibs/docs/dev/traits/create-effect"},next:{title:"Custom Unlocks",permalink:"/RogueLibs/docs/dev/unlocks/custom-unlocks"}},d=[{value:"Using <code>SimpleInteractionProvider</code> class",id:"simpleinteractionprovider",children:[],level:2},{value:"Implicit Buttons",id:"implicit-buttons",children:[],level:2},{value:"Stop Callbacks",id:"stop-callbacks",children:[],level:2},{value:"Side Effects (?)",id:"side-effects",children:[],level:2}],p={toc:d};function m(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-a-custom-interaction"},"Creating a Custom Interaction"),(0,r.kt)("h2",{id:"simpleinteractionprovider"},"Using ",(0,r.kt)("inlineCode",{parentName:"h2"},"SimpleInteractionProvider")," class"),(0,r.kt)("p",null,"The simplest way to create custom interactions is by using a ",(0,r.kt)("inlineCode",{parentName:"p"},"SimpleInteractionProvider")," class. It allows you to utilize all of the object-oriented programming principles and keeps the code simple and straightforward. Use ",(0,r.kt)("inlineCode",{parentName:"p"},"RogueInteractions.CreateProvider<T>")," methods to create instances of that class. You can add buttons using ",(0,r.kt)("inlineCode",{parentName:"p"},"h.AddButton")," inside the handler."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'// highlight-next-line\nRogueInteractions.CreateProvider<Crate>(static h => /* h - handler */\n{\n    // If interacted with via hacking, do not add the button\n    if (h.Helper.interactingFar) return;\n\n    InvItem crateOpener = h.Agent.inventory.FindItem("CrateOpener");\n    if (crateOpener is not null)\n    {\n        // Add the button with a name "UseCrateOpener", with " (<count>) -1" string added to the end\n        string extra = $" ({crateOpener.invItemCount}) -1";\n        // highlight-next-line\n        h.AddButton("UseCrateOpener", extra, static m => /* m - interaction model */\n        {\n            m.Agent.inventory.SubtractFromItemCount(m.Agent.inventory.FindItem("CrateOpener"), 1);\n            m.Object.UnlockCrate();\n            m.Object.ShowChest();\n        });\n    }\n});\n\n// Don\'t forget to add the localization string for "UseCrateOpener"\nRogueLibs.CreateCustomName("UseCrateOpener", NameTypes.Interface,\n                           new CustomNameInfo("Use Crate Opener"));\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Handler purity")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Handler methods must be pure, that is, they shouldn't make any visible changes. All of the logic must be contained in buttons, ",(0,r.kt)("a",{parentName:"p",href:"#stop-callbacks"},"stop callbacks")," and ",(0,r.kt)("a",{parentName:"p",href:"#side-effects"},"side effects"),"."))),(0,r.kt)("p",null,"If you have complicated logic with buttons, you can delegate their actions to local or declared methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'RogueInteractions.CreateProvider<Crate>(static h =>\n{\n    // highlight-next-line\n    static void UseCrateOpener(InteractionModel<Crate> model)\n    { \n        /* ... */\n    }\n\n    // highlight-next-line\n    h.AddButton("UseCrateOpener", UseCrateOpener);\n});\n')),(0,r.kt)("p",null,"By specifying a type parameter to the method (like ",(0,r.kt)("inlineCode",{parentName:"p"},"CreateProvider<Crate>"),"), it will narrow down the type of objects that you want to add interactions to. If your action may affect multiple types of objects, you can use the more general ",(0,r.kt)("inlineCode",{parentName:"p"},"CreateProvider")," method, that is triggered on all kinds of objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'// highlight-next-line\nRogueInteractions.CreateProvider(static h =>\n{\n    if (h.Object is Crate)\n        h.AddButton("UseCrateOpener", static m => { /* ... */ });\n    else if (h.Object is Safe)\n        h.AddButton("UseSafeOpener", static m => { /* ... */ });\n    else if (h.Object is Agent)\n        h.AddButton("UseSkullOpener", static m => { /* ... */ });\n});\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Note the staticity of the lambdas")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is important that you do not reference ",(0,r.kt)("inlineCode",{parentName:"p"},"h")," or other variables inside button actions, as they are called in different phases of the interaction process (an exception will be thrown). I recommend using the ",(0,r.kt)("inlineCode",{parentName:"p"},"static")," keyword when writing lambda expressions to avoid that."))),(0,r.kt)("h2",{id:"implicit-buttons"},"Implicit Buttons"),(0,r.kt)("p",null,'Sometimes buttons represent interactions so obvious that you don\'t want the player to explicitly press them. For example, doors. It would be a nuisance to press "Open" every time you interact with the door. An ',(0,r.kt)("strong",{parentName:"p"},"implicit button")," is pressed automatically if it's the only button in the menu; otherwise, it acts as a regular button."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'RogueInteractions.CreateProvider<Crate>(static h =>\n{\n    // highlight-next-line\n    h.AddImplicitButton("InspectWeirdCrate", static m =>\n    {\n        /* ... */\n        m.Agent.SayDialogue("InspectWeirdCrate");\n    });\n\n    if (h.Agent.inventory.HasItem("CrateOpener"))\n    {\n        h.AddButton("UseCrateOpener", static m => { /* ... */ });\n    }\n});\n')),(0,r.kt)("p",null,"If the player doesn't have a Crate Opener, the ",(0,r.kt)("inlineCode",{parentName:"p"},'"InspectWeirdCrate"')," button will be pressed immediately, without even showing the buttons. If the player has a Crate Opener though, a menu with 2 buttons will pop up (2, not counting the ",(0,r.kt)("inlineCode",{parentName:"p"},'"Done"')," button)."),(0,r.kt)("h2",{id:"stop-callbacks"},"Stop Callbacks"),(0,r.kt)("p",null,"If your specific interaction failed, but some other interactions from other mods might still work, use ",(0,r.kt)("strong",{parentName:"p"},"stop callbacks"),". They are called only if there are no other buttons in the menu, or if the interaction is stopped using ",(0,r.kt)("inlineCode",{parentName:"p"},"StopInteraction"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'RogueInteractions.CreateProvider<Crate>(static h =>\n{\n    if (h.Helper.interactingFar) return;\n\n    if (!h.Agent.inventory.HasItem("CrateOpener"))\n    {\n        // highlight-start\n        h.SetStopCallback(static m =>\n        {\n            m.gc.audioHandler.Play(m.Agent, "CantDo");\n            m.Agent.SayDialogue("NeedCrateOpener");\n        });\n        // highlight-end\n    }\n    /* ... */\n});\n')),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Overriding stop callbacks")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"By default, ",(0,r.kt)("inlineCode",{parentName:"p"},"SetStopCallback")," doesn't override any previously defined stop callbacks, so if you want to override them, add ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," as a second parameter."))),(0,r.kt)("p",null,"If your interaction failed miserably, not allowing the player to press any other buttons, or if you just want the player to go do something else right after this interaction, use ",(0,r.kt)("inlineCode",{parentName:"p"},"m.StopInteraction()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'RogueInteractions.CreateProvider<Crate>(static h =>\n{\n    if (h.Helper.interactingFar) return;\n\n    if (h.Agent.HasTrait("CrateBomber"))\n    {\n        h.AddButton("TriggerBomb", static m =>\n        {\n            m.gc.spawnerMain.SpawnExplosion(m.Object, m.Object.tr.position, "Big");\n            // highlight-next-line\n            m.StopInteraction();\n        })\n    }\n});\n')),(0,r.kt)("h2",{id:"side-effects"},"Side Effects (?)"),(0,r.kt)("p",null,"Sometimes you might need to do some stuff right after the button setup. For example, make the interacted agent react to you interacting with them. ",(0,r.kt)("strong",{parentName:"p"},"Side effects")," are called right after the buttons are set up, but before stop callbacks. So, side effects might get called even if the interaction failed or if there are no available buttons."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},'RogueInteractions.CreateProvider<Crate>(static h =>\n{\n    // Make the interacting agent say something right after interacting\n    // with the crate, even if they don\'t have the Crate Opener.\n    // highlight-start\n    h.SetSideEffect(static m => m.Agent.SayDialogue("DialogueWeirdCrate"));\n    // highlight-end\n    \n    if (h.Agent.inventory.HasItem("CrateOpener"))\n    {\n        h.AddButton("UseCrateOpener", static m =>\n        {\n            /* ... */\n        });\n    }\n});\n')),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Overriding side effects")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"By default, ",(0,r.kt)("inlineCode",{parentName:"p"},"SetSideEffect")," doesn't override any previously defined side effects, so if you want to override them, add ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," as a second parameter."))))}m.isMDXComponent=!0}}]);