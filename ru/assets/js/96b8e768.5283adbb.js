"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2398],{9392:(e,t,s)=>{s.r(t),s.d(t,{Bad:()=>h,Good:()=>c,assets:()=>d,contentTitle:()=>a,default:()=>m,frontMatter:()=>i,metadata:()=>r,nearXmas:()=>u,toc:()=>l});var o=s(5893),n=s(1151);const i={title:"Advice to SoR2 modders",author:"Abbysssal",author_title:"Creator of RogueLibs",author_url:"https://github.com/Chasmical",author_image_url:"https://github.com/Chasmical.png",image:"https://raw.githubusercontent.com/Chasmical/RogueLibs/refs/heads/main/website/blog/2024-10-15/my-bingo-card.png",tags:["blog","roguelibs","sor","sor2"],description:"... I really did want to mod SoR2, but the current state of the code doesn't allow it. The excuse \"It's just a demo/playtest\" doesn't work here. I didn't test how optimized or buggy the game is, I only looked at the code itself. And it's a mess. It's a mess that I don't want to deal with. If you want to mod SoR2, then... good luck."},a="Advice to SoR2 modders",r={permalink:"/RogueLibs/ru/blog/2024/10/15/advice-to-sor2-modders",source:"@site/blog/2024-10-15/advice-to-sor2-modders.mdx",title:"Advice to SoR2 modders",description:"... I really did want to mod SoR2, but the current state of the code doesn't allow it. The excuse \"It's just a demo/playtest\" doesn't work here. I didn't test how optimized or buggy the game is, I only looked at the code itself. And it's a mess. It's a mess that I don't want to deal with. If you want to mod SoR2, then... good luck.",date:"2024-10-15T00:00:00.000Z",formattedDate:"15 \u043e\u043a\u0442\u044f\u0431\u0440\u044f 2024 \u0433.",tags:[{label:"blog",permalink:"/RogueLibs/ru/blog/tags/blog"},{label:"roguelibs",permalink:"/RogueLibs/ru/blog/tags/roguelibs"},{label:"sor",permalink:"/RogueLibs/ru/blog/tags/sor"},{label:"sor2",permalink:"/RogueLibs/ru/blog/tags/sor-2"}],readingTime:8.511111111111111,hasTruncateMarker:!0,authors:[{name:"Abbysssal",title:"Creator of RogueLibs",url:"https://github.com/Chasmical",imageURL:"https://github.com/Chasmical.png"}],frontMatter:{title:"Advice to SoR2 modders",author:"Abbysssal",author_title:"Creator of RogueLibs",author_url:"https://github.com/Chasmical",author_image_url:"https://github.com/Chasmical.png",image:"https://raw.githubusercontent.com/Chasmical/RogueLibs/refs/heads/main/website/blog/2024-10-15/my-bingo-card.png",tags:["blog","roguelibs","sor","sor2"],description:"... I really did want to mod SoR2, but the current state of the code doesn't allow it. The excuse \"It's just a demo/playtest\" doesn't work here. I didn't test how optimized or buggy the game is, I only looked at the code itself. And it's a mess. It's a mess that I don't want to deal with. If you want to mod SoR2, then... good luck."},unlisted:!1,nextItem:{title:"Discontinuing RogueLibs",permalink:"/RogueLibs/ru/blog/2024/02/03/discontinuing-roguelibs"}},d={authorsImageUrls:[void 0]},l=[{value:"Bingo space explanations",id:"bingo-space-explanations",level:2},{value:"The evil code prevails",id:"the-evil-code-prevails",level:2},{value:"State of the game",id:"state-of-the-game",level:2},{value:"A few last tidbits",id:"a-few-last-tidbits",level:2},{value:"\ud83d\udc4b",id:"goodbye",level:2}],h=({children:e})=>{const t={b:"b",...(0,n.a)()};return(0,o.jsx)(t.b,{style:{color:"#d54e4e"},children:e})},c=({children:e})=>{const t={b:"b",...(0,n.a)()};return(0,o.jsx)(t.b,{style:{color:"#4ed54e"},children:e})},u=()=>{const e=(new Date).getUTCMonth();return 0==e||11==e};function p(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{children:(0,o.jsx)("span",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-500)"},children:"(there was a lovecraftian-type story here that I wrote, but I was left unsatisfied with it, so I removed it; if\xa0you want, you can still find it and read it through GitHub's repo commit history)"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:s(1275).Z+"",width:"3747",height:"1735"})}),"\n",(0,o.jsx)(t.p,{children:"Several weeks prior to the demo, I thought it'd be fun to play a bingo game, centered around SoR2's code. I came up with a bunch of spaces, about both the good and the bad code. I announced that in SoR's Discord, and started slowly revealing the spaces on the cards. At first, one space a day, and then two spaces per day, as the demo's release date approached."}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:'Update (30/12/24): Ignore the "Directions are enums" space being checked on the left. At the time, I was just so happy to see an enum in the code, that I didn\'t even look at how that enum was used. I\xa0was not aware it was possible to misuse enums that badly...'})}),"\n",(0,o.jsx)(t.h2,{id:"bingo-space-explanations",children:"Bingo space explanations"}),"\n",(0,o.jsx)(t.p,{children:"When I was in the process of revealing bingo card spaces, I had plenty of time, so I provided detailed explanations for some of them."}),"\n","\n",(0,o.jsxs)(t.p,{children:["Good spaces are ",(0,o.jsx)(c,{children:"green"})," (left card), Bad spaces are ",(0,o.jsx)(h,{children:"red"})," (right card)."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"X and Y instead of Vector2."})," The entire purpose of structures is to group similar and relevant data together. This way the processor can address the data much faster. Another thing that structures can do - is align the fields' padding with the processor's architecture (that's what the JIT compiler does) for more efficient access. Structures can also be copied much quicker than individual components, - that's just the value type semantics. And, of course, Vector2 is much more readable and easier to understand than just a pair of separate components."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(c,{children:"Argument validation."})," Validating input data and throwing exceptions. Invalid state is the main cause of errors that are caused by other errors. An exception throw in a correct place (or even just a conditional statement) would stop the program, before it does anything that corrupts state. Sure, I understand that it'd be weird for a game to crash after just a single exception, but that's what exception handling is for (try-catch block)."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"Loop-switch sequence."})," This one has ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Loop-switch_sequence",children:"a Wikipedia article"}),", so I'll suggest you read it instead. Examples in SoR1: ",(0,o.jsx)(t.code,{children:"Agent.LoadDialogue()"}),", ",(0,o.jsx)(t.code,{children:"AgentHitbox.SetupBodyStrings()"}),", ",(0,o.jsx)(t.code,{children:"InvSlot.SortItems()"}),", ",(0,o.jsx)(t.code,{children:"InvSlot.SortUseItems()"}),", ",(0,o.jsx)(t.code,{children:"LevelEditor.RefreshCustomCharacters()"})," (x2), ",(0,o.jsx)(t.code,{children:"LevelEditor.SaveChunkData()"}),", ",(0,o.jsx)(t.code,{children:"LevelEditor.OpenLoadExtra()"}),", ",(0,o.jsx)(t.code,{children:"MouseCursorSets.SetupCursors()"})," (x2), ",(0,o.jsx)(t.code,{children:"PoolsScene.SetupWalls()"})," (x2), ",(0,o.jsx)(t.code,{children:"PoolsScene.DoInstantiate()"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(c,{children:"SPANS?!?!?."})," Now this is quite a reach, I know. The purpose of ",(0,o.jsx)(t.code,{children:"Span<T>"})," is to reduce the amount of unnecessary array/string allocations in synchronous operations. The performance improvement would be noticeable, and memory usage would go down by a lot, but that's only if all the libraries involved can handle this sort of data, and Unity doesn't know how to handle spans (or even ",(0,o.jsx)(t.code,{children:"Memory<T>"}),'). This is more of a "new .NET" thing, rather than a general code improvement. If one were to be looking for a .NET library for something, they\'d definitely give more preference to ones that use spans. SoR doesn\'t have much of a "back-end" that could use this sort of improvement, so I wouldn\'t expect it.']}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"Improper list population w/ excessive copying."})," There is a way to populate a list very inefficiently, that involves ",(0,o.jsx)(t.code,{children:"Insert"}),". And that's pretty much all there is to it. It's very inefficient, forcing the list to recopy the entire array just one item over, every time an item is added. Also, another few small, related things: ",(0,o.jsx)(t.code,{children:"Add"})," in a loop is much less efficient than ",(0,o.jsx)(t.code,{children:"AddRange"}),", - lists are good at copying collections. And lastly, lists shouldn't be used as queues, queues should be used as queues."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(c,{children:"Version control (free!)."})," A free space! We already know that Matt is using version control (Unity's kind, but version control nonetheless). Version control is an important element in development of any project, even if you're the only developer. It helps keep track of the changes you made since the last release, allows you to easily backtrack and look back at old code, makes you think in terms of features and components instead of just doing whatever works and going along with it, and makes collaboration with others easy."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"Enormous if-chain."})," A lot of ",(0,o.jsx)(t.code,{children:"if"}),"s chained one after another (more than, like, 10). It never makes sense to have that many chained ",(0,o.jsx)(t.code,{children:"if"}),"s, - you either don't know what a ",(0,o.jsx)(t.code,{children:"switch"})," statement is, or you messed up really badly with your program's structure."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(c,{children:"Directions are enums."})," In SoR1 directions are ",(0,o.jsx)(t.strong,{children:"strings"}),", - the most inefficient method anyone could ever think of. A beginner programmer's instinct should be to use small integers to represent directions, not strings! The overhead here is enormous even on the latest versions of .NET: comparison is 3x slower, memory usage is 2x greater (Note: interned strings in the SOH are negligible, but still...)."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"isAgent, isItem, isFire, isBullet, isObjectReal fields."})," Instead of type-checking an object (",(0,o.jsx)(t.code,{children:"is"})," expression), Matt first uses one of these 11 fields, defined on ",(0,o.jsx)(t.code,{children:"PlayfieldObject"}),", and only then casts an object to the needed type. It's completely unnecessary, as this doesn't eliminate the type-check, - the runtime still needs to be sure the object is of the correct type, and throws an exception if it isn't. These fields add an overhead of 11 bytes to each object, and don't do anything besides these unnecessarily complex type casts. It's just a bad, uninformed design decision, nothing too serious, since modders can still use type-checks in a correct way."]}),"\n"]}),"\n"]}),"\n","\n",u()?(0,o.jsx)(t.p,{children:"Festive, huh?"}):"","\n",(0,o.jsx)(t.p,{children:"And that's all the explanations. I only had the time to explain 9 random spaces, before the demo dropped, and now I'm not nearly as motivated to do the rest, since I've got nothing to hype up."}),"\n",(0,o.jsx)(t.h2,{id:"the-evil-code-prevails",children:"The evil code prevails"}),"\n",(0,o.jsxs)(t.p,{children:["Needless to say, none of the ",(0,o.jsx)(c,{children:"good"})," spaces, listed or otherwise, ended up being checked in the bingo. Aside from the 3 ",(0,o.jsx)(c,{children:"FREE good"})," spaces, that is, but even they're under scrutiny (especially ",(0,o.jsx)(c,{children:"OOP"}),")."]}),"\n",(0,o.jsxs)(t.p,{children:["I couldn't confirm a few ",(0,o.jsx)(h,{children:"bad"})," spaces on my bingo card, since those ones required a deeper and more thorough investigation. It'd be easier to list the ones that were confirmed as ",(0,o.jsx)(t.strong,{children:"NOT"})," checked:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"Unrelated code."})," This time only SoR2's stuff was added to the game. No irrelevant snippets or fragments of code blindly copied from elsewhere for unknown reasons."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(h,{children:"Data clumps."})," I couldn't find any methods that this term would apply to, since it specifically refers to variables and method parameters. Some parts of the code certainly do feel full of data-clumps, but they're all already grouped into classes."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The rest of the ",(0,o.jsx)(h,{children:"bad"})," spaces either were checked or are unconfirmed."]}),"\n",(0,o.jsx)(t.h2,{id:"state-of-the-game",children:"State of the game"}),"\n",(0,o.jsx)(t.p,{children:"I really did want to mod SoR2, but the current state of the code doesn't allow it. The excuse \"It's just a demo/playtest\" doesn't work here. I didn't test how optimized or buggy the game is, I only looked at the code itself. And it's a mess. It's a mess that I don't want to deal with."}),"\n",(0,o.jsx)(t.p,{children:"Regarding modding tooling that Matt promises: that would be completely different from the modding we did with SoR1. Waiting until Matt adds support for something is very different from implementing the thing yourself. He's an only developer, and his hands are already full with just the base game."}),"\n",(0,o.jsx)(t.p,{children:"And finally, for me personally, the most interesting thing about modding is creating something, that's vastly different from the original. Something weird, extrinsic, grand, silly, weird. For something of that degree of peculiarity, you'd at least have to make use of C#'s more advanced constructs. And Matt outright refuses to use any, other than classes, methods and fields."}),"\n",(0,o.jsx)(t.p,{children:"If you want to mod SoR2, then... good luck."}),"\n",(0,o.jsx)(t.h2,{id:"a-few-last-tidbits",children:"A few last tidbits"}),"\n",(0,o.jsxs)(t.p,{children:["Apparently, in SoR2, gender is a bool variable (see ",(0,o.jsx)(t.code,{children:"bool Agent.genderF"}),")."]}),"\n",(0,o.jsxs)(t.p,{children:["The only thing separating animals from humans is an ",(0,o.jsx)(t.code,{children:"isAnimal"})," flag."]}),"\n",(0,o.jsxs)(t.p,{children:["Boats are just water cars in SoR2's world. (all vehicles are instances of the ",(0,o.jsx)(t.code,{children:"Car"})," class)"]}),"\n",(0,o.jsx)(t.p,{children:"The code initializing outfit colors just couldn't be more wet or hardcoded."}),"\n",(0,o.jsx)(t.p,{children:"Direction enums in SoR2 are awful and completely non-mathable. Take a look at this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-csharp",children:"public enum DirectionType { None, N, S, E, W, NE, SE, NW, SW, Wait }\n"})}),"\n",(0,o.jsxs)(t.p,{children:["North (0\xb0), then South (180\xb0), then East (90\xb0), and then West (270\xb0)... WTF.",(0,o.jsx)(t.br,{}),"\n","It's all out of order AND misaligned as well, due to ",(0,o.jsx)(t.code,{children:"None"})," taking up the ",(0,o.jsx)(t.code,{children:"0"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["Speaking of directions... The vehicles... They're.. uh... Their directions are both strings ",(0,o.jsx)(t.strong,{children:"and"})," numbers... There are no switches. Just ifs... Wet. It's so wet... It's painful to describe. It's arguably one of the most disgusting pieces of code in the game."]}),"\n",(0,o.jsx)(t.p,{children:"No signs of generics, interfaces, exception handling, structures, properties, events, reflection, attributes, try-finally, asynchronicity, object disposal, or any other above-basic-level constructs."}),"\n",(0,o.jsx)(t.h2,{id:"goodbye",children:"\ud83d\udc4b"}),"\n",(0,o.jsx)(t.p,{children:"Once again, good luck trying to mod this. I'll be taking my leave here."})]})}function m(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},1275:(e,t,s)=>{s.d(t,{Z:()=>o});const o=s.p+"assets/images/my-bingo-card-a89ae239b07f2c9ed353cb37f0e35fb6.png"},1151:(e,t,s)=>{s.d(t,{Z:()=>r,a:()=>a});var o=s(7294);const n={},i=o.createContext(n);function a(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);